# Mental AI Assistant - Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (React)                        â”‚
â”‚                    http://localhost:5173                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  AppHeader   â”‚  â”‚  Consent  â”‚  â”‚ CrisisHelp   â”‚            â”‚
â”‚  â”‚   + Tamil    â”‚  â”‚  Banner   â”‚  â”‚  (Always     â”‚            â”‚
â”‚  â”‚   Chip       â”‚  â”‚           â”‚  â”‚   Visible)   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Main Card                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚  DevicePicker (Select Microphone)            â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚  StatusChip:                                  â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  Idle | Listening | Transcribing |           â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  Responding | Speaking                       â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚   â”‚
â”‚  â”‚              â”‚   VoiceButton     â”‚                     â”‚   â”‚
â”‚  â”‚              â”‚   ğŸ¤ (96x96px)    â”‚                     â”‚   â”‚
â”‚  â”‚              â”‚   Push to Talk    â”‚                     â”‚   â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–â–â–â–â–â–â–â–] Mic Level                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              TranscriptPane                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ User: à®µà®£à®•à¯à®•à®®à¯ à®à®ªà¯à®ªà®Ÿà®¿ à®‡à®°à¯à®•à¯à®•à¯€à®™à¯à®•              â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ Assistant: à®¨à®¾à®©à¯ à®¨à®²à®®à®¾à®• à®‡à®°à¯à®•à¯à®•à®¿à®±à¯‡à®©à¯. à®¨à®©à¯à®±à®¿!  â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ”Š [Audio Player]                            â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ WebSocket-like chunking
                              â”‚ (2-3 second audio chunks)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND SERVICES (FastAPI)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Media Service      â”‚  â”‚  Speech Service      â”‚  â”‚ Reasoning Service   â”‚
â”‚   Port 8001          â”‚  â”‚  Port 8002           â”‚  â”‚ Port 8003           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      â”‚  â”‚                      â”‚  â”‚                     â”‚
â”‚ POST /media/         â”‚  â”‚ POST /stt/chunk      â”‚  â”‚ POST /respond       â”‚
â”‚      chunk-upload    â”‚  â”‚   â€¢ Groq Whisper     â”‚  â”‚   â€¢ Groq Llama      â”‚
â”‚                      â”‚  â”‚     large-v3-turbo   â”‚  â”‚     3.3-70B         â”‚
â”‚ â€¢ Validates audio    â”‚  â”‚   â€¢ Returns Tamil    â”‚  â”‚   â€¢ Safety checks   â”‚
â”‚ â€¢ Forwards to STT â”€â”€â”€â”€â”€â”€â–¶â”‚     text             â”‚  â”‚   â€¢ Crisis detect   â”‚
â”‚ â€¢ Cleans up file     â”‚  â”‚                      â”‚  â”‚                     â”‚
â”‚   (audio doesn't     â”‚  â”‚ POST /tts/speak      â”‚  â”‚ POST /events/risk   â”‚
â”‚    persist)          â”‚  â”‚   â€¢ Google Cloud TTS â”‚  â”‚   â€¢ Logs to         â”‚
â”‚                      â”‚  â”‚     (ta-IN)          â”‚  â”‚     risk-log.jsonl  â”‚
â”‚ GET /health          â”‚  â”‚   â€¢ Caches by hash   â”‚  â”‚                     â”‚
â”‚                      â”‚  â”‚                      â”‚  â”‚ GET /health         â”‚
â”‚                      â”‚  â”‚ GET /audio/cache/:id â”‚  â”‚                     â”‚
â”‚                      â”‚  â”‚ GET /health          â”‚  â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                          â”‚                          â”‚
         â”‚                          â”‚                          â”‚
         â–¼                          â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase A (Current)    â”‚  â”‚ Phase A (Current)    â”‚  â”‚ Phase A (Current)   â”‚
â”‚ â€¢ No storage         â”‚  â”‚ â€¢ Groq API           â”‚  â”‚ â€¢ Groq API          â”‚
â”‚ â€¢ Temp files only    â”‚  â”‚ â€¢ Google Cloud TTS   â”‚  â”‚ â€¢ LLama 3.3-70B     â”‚
â”‚                      â”‚  â”‚                      â”‚  â”‚                     â”‚
â”‚ Phase B (Future)     â”‚  â”‚ Phase B (Future)     â”‚  â”‚ Phase B (Future)    â”‚
â”‚ â€¢ Same interface     â”‚  â”‚ â€¢ Whisper.cpp local  â”‚  â”‚ â€¢ Quantized 1-3B    â”‚
â”‚                      â”‚  â”‚ â€¢ System TTS         â”‚  â”‚   local model       â”‚
â”‚                      â”‚  â”‚ â€¢ MMS-TTS fallback   â”‚  â”‚ â€¢ llama.cpp/MLC-LLM â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

### 1. User Speaks (Press & Hold)
```
Frontend â†’ MediaRecorder â†’ 2-3s chunk â†’ Blob
```

### 2. Upload & Transcribe
```
Blob â†’ POST /media/chunk-upload?session_id&sequence_index
     â†’ Media Service validates
     â†’ Forwards to POST /stt/chunk
     â†’ Speech Service (Groq Whisper API)
     â†’ Returns: { text: "à®µà®£à®•à¯à®•à®®à¯", language: "ta" }
     â†’ Media Service returns to frontend
```

### 3. Generate Response
```
Frontend â†’ POST /respond
         { session_id, transcript_window: ["à®µà®£à®•à¯à®•à®®à¯"], locale: "ta-IN" }
         â†’ Reasoning Service
           â€¢ Pre-check: Crisis keywords?
           â€¢ If high-risk: return crisis template + log event
           â€¢ Else: LLM generates reply
           â€¢ Post-check: Safe response?
         â†’ Returns: { reply_text, risk_flags }
```

### 4. Text-to-Speech
```
Frontend â†’ POST /tts/speak
         { text: "à®¨à®¾à®©à¯ à®‡à®™à¯à®•à¯‡ à®‰à®™à¯à®•à®³à¯à®•à¯à®•à¯ à®‰à®¤à®µ à®‡à®°à¯à®•à¯à®•à®¿à®±à¯‡à®©à¯", voice: "ta-IN" }
         â†’ Speech Service
           â€¢ Check cache by hash
           â€¢ If not cached: Google Cloud TTS API
           â€¢ Save to audio_cache/
         â†’ Returns: { file_url: "/audio/cache/abc123.mp3" }
```

### 5. Play Audio
```
Frontend â†’ GET /audio/cache/abc123.mp3
         â†’ Speech Service serves cached MP3
         â†’ Audio element plays
         â†’ Updates status: Speaking â†’ Idle
```

## Safety Guardrails Flow

```
User Input: "à®¤à®±à¯à®•à¯Šà®²à¯ˆ" (suicide)
    â†“
Pre-check (reasoning-service/app/safety.py)
    â€¢ Keyword match: self_harm_keywords
    â€¢ is_high_risk = True
    â†“
Crisis Template Generated
    â€¢ Tamil Nadu Helpline: 044-46464646
    â€¢ National Helpline: 9152987821
    â†“
Risk Event Logged
    â€¢ File: risk-log.jsonl
    â€¢ Data: { session_id, event_type, keywords, timestamp }
    â†“
Frontend Display
    â€¢ Risk banner appears
    â€¢ Crisis helpline info highlighted
    â€¢ No LLM call made (crisis template used)
```

## Privacy Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User's Device   â”‚
â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Audio Blob â”‚  â”‚ â—„â”€â”€ STAYS ON DEVICE
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚         â”‚
â”‚        â–¼         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ MediaRecorderâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚         â”‚
â”‚        â–¼         â”‚
â”‚  Temporary uploadâ”‚
â”‚  to local serviceâ”‚ â—„â”€â”€ DELETED IMMEDIATELY
â”‚  (localhost:8001)â”‚
â”‚        â”‚         â”‚
â”‚        â–¼         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Transcribedâ”‚  â”‚ â—„â”€â”€ TEXT ONLY (Phase A)
â”‚  â”‚ Text       â”‚  â”‚     sent to APIs
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
   [Groq API] â—„â”€â”€ PHASE A: External APIs for accuracy
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Local Models     â”‚ â—„â”€â”€ PHASE B: Everything on-device
â”‚ â€¢ Whisper Tiny   â”‚
â”‚ â€¢ 1-3B LLM       â”‚
â”‚ â€¢ System TTS     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Interactions

```
useRecorder Hook
    â”‚
    â”œâ”€ startRecording()
    â”‚   â””â”€ MediaRecorder.start()
    â”‚       â””â”€ dataavailable event
    â”‚           â””â”€ onChunkReady(blob, sequenceIndex)
    â”‚
    â””â”€ stopRecording()
        â””â”€ MediaRecorder.stop()

useSession Hook
    â”‚
    â”œâ”€ sessionId (UUID generated on mount)
    â”œâ”€ chunkIndex (increments with each chunk)
    â”œâ”€ riskFlags (from reasoning service)
    â””â”€ resetSession() (for new conversation)

API Client (fetch-based)
    â”‚
    â”œâ”€ uploadChunk() â†’ Media Service
    â”œâ”€ getResponse() â†’ Reasoning Service
    â”œâ”€ generateTTS() â†’ Speech Service
    â””â”€ checkHealth() â†’ All services
```

## File Sizes (Estimated)

```
Audio chunk (2s, webm):     ~50 KB
Transcription response:     <1 KB (JSON)
LLM response:               ~2 KB (JSON + metadata)
TTS audio (MP3):            ~40 KB (cached)

Total per turn:             ~93 KB
```

## Latency Targets (Phase A)

```
Audio chunk upload:         100-200ms
STT (Groq Whisper):         500-1000ms
LLM (Groq Llama):          1000-2000ms
TTS (Google Cloud):         500-1000ms  (cached: <50ms)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total (uncached):           ~3-5s
Total (cached TTS):         ~2-4s
```

---

**Key Design Principles:**
1. Audio never persists (deleted immediately)
2. Only text sent externally (Phase A)
3. Multi-layer safety (pre + post checks)
4. Crisis detection always active
5. Provider abstraction for Phase B
6. Local-only risk logging
7. No PHI storage
